{"version":3,"sources":["requireAndAskPermissions.ts"],"names":["NativeModules","Platform","PermissionsAndroid","ANDROID_KIT_KAT_SDK_VERSION","androidPermissionRequestRequired","Version","parseInt","requireAndAskPermissions","options","url","urls","OS","resultArr","Promise","all","map","resolve","reject","RNShare","isBase64File","error","isBase64","requirePermission","includes","hasPermission","check","PERMISSIONS","WRITE_EXTERNAL_STORAGE","result","request","RESULTS","GRANTED","Error","e"],"mappings":"AAAA,SAASA,aAAT,EAAwBC,QAAxB,EAAkCC,kBAAlC,QAA4D,cAA5D;AAIA,MAAMC,2BAA2B,GAAG,EAApC;AACA,MAAMC,gCAAgC,GACpC,CAAC,OAAOH,QAAQ,CAACI,OAAhB,KAA4B,QAA5B,GAAuCC,QAAQ,CAACL,QAAQ,CAACI,OAAV,EAAmB,EAAnB,CAA/C,GAAwEJ,QAAQ,CAACI,OAAlF,IACAF,2BAFF;;AAIA,MAAMI,wBAAwB,GAAG,OAC/BC,OAD+B,KAEF;AAC7B,MAAI,CAACA,OAAO,CAACC,GAAR,IAAeD,OAAO,CAACE,IAAxB,KAAiCT,QAAQ,CAACU,EAAT,KAAgB,SAArD,EAAgE;AAC9D,UAAMD,IAAc,GAAGF,OAAO,CAACE,IAAR,KAAiBF,OAAO,CAACC,GAAR,GAAc,CAACD,OAAO,CAACC,GAAT,CAAd,GAA8B,EAA/C,CAAvB;;AACA,QAAI;AACF,YAAMG,SAAS,GAAG,MAAMC,OAAO,CAACC,GAAR,CACtBJ,IAAI,CAACK,GAAL,CACGN,GAAD,IACE,IAAII,OAAJ,CAAY,CAACG,OAAD,EAAUC,MAAV,KAAqB;AAC/BjB,QAAAA,aAAa,CAACkB,OAAd,CAAsBC,YAAtB,CACEV,GADF,EAEGW,KAAD,IAAW;AACTH,UAAAA,MAAM,CAACG,KAAD,CAAN;AACD,SAJH,EAKGC,QAAD,IAAc;AACZL,UAAAA,OAAO,CAACK,QAAD,CAAP;AACD,SAPH;AASD,OAVD,CAFJ,CADsB,CAAxB;AAiBA,YAAMC,iBAAiB,GAAGV,SAAS,CAACW,QAAV,CAAmB,IAAnB,CAA1B;;AACA,UAAI,CAACD,iBAAL,EAAwB;AACtB,eAAOT,OAAO,CAACG,OAAR,CAAgB,IAAhB,CAAP;AACD;;AACD,YAAMQ,aAAa,GAAG,MAAMtB,kBAAkB,CAACuB,KAAnB,CAC1BvB,kBAAkB,CAACwB,WAAnB,CAA+BC,sBADL,CAA5B;;AAGA,UAAIH,aAAJ,EAAmB;AACjB,eAAOX,OAAO,CAACG,OAAR,CAAgB,IAAhB,CAAP;AACD;;AAED,UAAIZ,gCAAJ,EAAsC;AACpC,cAAMwB,MAAM,GAAG,MAAM1B,kBAAkB,CAAC2B,OAAnB,CACnB3B,kBAAkB,CAACwB,WAAnB,CAA+BC,sBADZ,CAArB;;AAGA,YAAIC,MAAM,KAAK1B,kBAAkB,CAAC4B,OAAnB,CAA2BC,OAA1C,EAAmD;AACjD,iBAAOlB,OAAO,CAACG,OAAR,CAAgB,IAAhB,CAAP;AACD;;AACD,cAAM,IAAIgB,KAAJ,CAAU,gCAAV,CAAN;AACD;AACF,KAtCD,CAsCE,OAAOC,CAAP,EAAU;AACV,aAAOpB,OAAO,CAACI,MAAR,CAAegB,CAAf,CAAP;AACD;AACF;;AACD,SAAOpB,OAAO,CAACG,OAAR,CAAgB,IAAhB,CAAP;AACD,CAhDD;;AAkDA,eAAeT,wBAAf","sourcesContent":["import { NativeModules, Platform, PermissionsAndroid } from 'react-native';\n\nimport { ShareOptions } from '../types';\n\nconst ANDROID_KIT_KAT_SDK_VERSION = 19;\nconst androidPermissionRequestRequired =\n  (typeof Platform.Version === 'string' ? parseInt(Platform.Version, 10) : Platform.Version) <\n  ANDROID_KIT_KAT_SDK_VERSION;\n\nconst requireAndAskPermissions = async (\n  options: Pick<ShareOptions, 'url' | 'urls'>,\n): Promise<boolean | never> => {\n  if ((options.url || options.urls) && Platform.OS === 'android') {\n    const urls: string[] = options.urls || (options.url ? [options.url] : []);\n    try {\n      const resultArr = await Promise.all(\n        urls.map(\n          (url) =>\n            new Promise((resolve, reject) => {\n              NativeModules.RNShare.isBase64File(\n                url,\n                (error) => {\n                  reject(error);\n                },\n                (isBase64) => {\n                  resolve(isBase64);\n                },\n              );\n            }),\n        ),\n      );\n\n      const requirePermission = resultArr.includes(true);\n      if (!requirePermission) {\n        return Promise.resolve(true);\n      }\n      const hasPermission = await PermissionsAndroid.check(\n        PermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE,\n      );\n      if (hasPermission) {\n        return Promise.resolve(true);\n      }\n\n      if (androidPermissionRequestRequired) {\n        const result = await PermissionsAndroid.request(\n          PermissionsAndroid.PERMISSIONS.WRITE_EXTERNAL_STORAGE,\n        );\n        if (result === PermissionsAndroid.RESULTS.GRANTED) {\n          return Promise.resolve(true);\n        }\n        throw new Error('Write Permission not available');\n      }\n    } catch (e) {\n      return Promise.reject(e);\n    }\n  }\n  return Promise.resolve(true);\n};\n\nexport default requireAndAskPermissions;\n"]}